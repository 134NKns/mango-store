<div class="p-grid p-dir-col p-ai-center p-jc-center full-height">
  <div class="p-col-12 p-md-10">
    <p-steps [model]="steps" [(activeIndex)]="activeIndex" [readonly]="false"></p-steps>
    <div [ngSwitch]="activeIndex" class="p-mt-3">
      <!-- Order Summary Step -->
      <div *ngSwitchCase="0" class="p-grid p-dir-col p-ai-center p-jc-center">
        <h2>Order Summary</h2>
        <table class="table">
          <thead>
            <tr>
              <th>ชื่อสินค้า</th>
              <th>จำนวน</th>
              <th>ราคา</th>
              <th>ส่วนลด</th>
              <th>รวม</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let detail of order.order_details">
              <td>{{ detail.product.name }}</td>
              <td>{{ detail.quantity }}</td>
              <td>{{ detail.price | currency:'THB':'symbol':'1.2-2' }}</td>
              <td>{{ formatDiscount(detail) }}</td>
              <td>{{ formatTotal(detail) }}</td>
            </tr>
          </tbody>
        </table>
        <div class="p-d-flex p-jc-end p-mt-3" style="width: 100%;">
          <h3>รวมทั้งหมด: {{ totalAmount | currency:'THB':'symbol':'1.2-2' }}</h3>
        </div>
        <div class="p-d-flex p-jc-between p-mt-3" style="width: 100%;">
          <button pButton label="Next" icon="pi pi-chevron-right" (click)="goToStep(1)"></button>
          <button pButton label="Cancel" icon="pi pi-times" class="p-button-danger" (click)="confirmCancel()"></button>
        </div>
      </div>
      <!-- Payment Step -->
      <div *ngSwitchCase="1" class="p-grid p-dir-col p-ai-center p-jc-center">
        <h2>Payment</h2>
        <div>
          <p>Central Account: {{ centralPayment.store_name }}</p>
          <p>{{centralPayment.phoneNumber}}</p>
          <app-qr-code 
            [phoneNumber]="centralPayment.phoneNumber" 
            [amount]="centralPayment.amount" 
            [userName]="centralPayment.userName">
          </app-qr-code>
          <p-fileUpload 
            mode="basic" 
            name="slip" 
            accept="image/*" 
            customUpload="true" 
            (onSelect)="onFileSelect($event)">
          </p-fileUpload>
        </div>
        <div class="p-d-flex p-jc-between p-mt-3" style="width: 100%;">
          <button pButton label="Previous" icon="pi pi-chevron-left" (click)="goToStep(0)"></button>
          <button pButton label="Next" icon="pi pi-chevron-right" (click)="onNext()" [disabled]="!selectedFile && !slipUploaded"></button>
          <button pButton label="Cancel" icon="pi pi-times" class="p-button-danger" (click)="confirmCancel()"></button>
        </div>
      </div>
      <!-- Thank You Step -->
      <div *ngSwitchCase="2" class="p-grid p-dir-col p-ai-center p-jc-center">
        <h2>Thank You</h2>
        <p>Thank you for your payment!</p>
        <div class="p-d-flex p-jc-between p-mt-3" style="width: 100%;">
          <button pButton label="Finish" icon="pi pi-check" (click)="finish()"></button>
          <button pButton label="Cancel" icon="pi pi-times" class="p-button-danger" (click)="confirmCancel()"></button>
        </div>
      </div>
    </div>
  </div>
  <p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle" acceptLabel="Yes" rejectLabel="No" (accept)="cancel()" message="คุณแน่ใจว่าต้องการยกเลิกการทำรายการนี้หรือไม่?"></p-confirmDialog>
</div>
